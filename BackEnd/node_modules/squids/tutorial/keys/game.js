/*
==========================================================
Demonstrates how to detect 'keydown' events, and how to poll
for keyboard status.
Use the WASD and SPACE keys.
==============================================================
*/

// Load an image with a call-back when finished
load_image( "squid.svg", function( image ) {

	// Get the width and height of the canvas
	let width = canvas.width
	let height = canvas.height

	// Create a squid
	let squid = new Squid()

	// Attach the graphic to the squid
	squid.image = image

	// Move the squid to the center of the canvas
	squid.position = vec( width * 0.5, height * 0.5 )

	// Scale the squid down to 50% size
	squid.scale = 0.5


	// Listen for the "tick" event.
	// This is called approximately 100 times per second
	squid.listen( "tick", function() {

		// check status of the WASD keys and move squid if one of them is pressed
		// Note: squid.rotation is in radians; A number that ranges from 0.0 to PI * 2 
		if( keys[ 'w' ] ) {
			squid.velocity = vec( 0, -2 )
			squid.rotation = 0
		} else if( keys[ 'd' ] ) {
			squid.velocity = vec( 2, 0 )
			squid.rotation = PI * 0.5
		} else if( keys[ 's' ] ) {
			squid.velocity = vec( 0, 2 )
			squid.rotation = PI
		} else if( keys[ 'a' ] ) {
			squid.velocity = vec( -2, 0 )
			squid.rotation = PI * 1.5
		} else {
			// if no keys pressed, then decelerate to 0 velocity
			// Note squid.velocity is a vector so use the mlt() method
			squid.velocity.mlt( 0.96 )
		}

		// increase opacity to 1.0 if it's less then 1.0 ( see 'space' below )
		if( squid.opacity < 1.0 ) {
			// Note squid.opacity is just a number that ranges from 0.0 to 1.0
			squid.opacity += 0.005
		}

	})

	// this is how you detect a key up or down event
	squid.listen( "keydown", function( k ) {

		if( k == 'space' ) {
			// make the squid become invisible momentarily
			squid.opacity = 0.0
		}

	})


	let font = load_font( "Arial", 30, "turquoise" );	// create a font
	let texter = new Squid();							// create a squid who's only purpose is to draw text
	texter.listen( "draw", function() {					// when it's time to draw ...
		// draw some text!
		draw_text( "Use W, A, S, D, and SPACE keys", width * 0.5, height * 0.1, font, "center", 1 );
	});


	// Start the tick event dispatcher so "tick" events will be dispatched to listeners
	tick( true )

}) 

